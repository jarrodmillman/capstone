<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using the bash shell &mdash; Capstone 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Capstone 0.1 documentation" href="../index.html" />
    <link rel="up" title="Appendices" href="index.html" />
    <link rel="next" title="Introduction to Git" href="git-intro.html" />
    <link rel="prev" title="Software installation" href="software.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-the-bash-shell">
<span id="bash-shell"></span><h1><a class="toc-backref" href="#id2">Using the bash shell</a><a class="headerlink" href="#using-the-bash-shell" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#using-the-bash-shell" id="id2">Using the bash shell</a><ul>
<li><a class="reference internal" href="#the-interactive-shell" id="id3">The Interactive Shell</a><ul>
<li><a class="reference internal" href="#getting-started" id="id4">Getting started</a></li>
<li><a class="reference internal" href="#variables" id="id5">Variables</a></li>
<li><a class="reference internal" href="#commands" id="id6">Commands</a></li>
<li><a class="reference internal" href="#shortcuts" id="id7">Shortcuts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-file-management" id="id8">Basic File Management</a><ul>
<li><a class="reference internal" href="#files" id="id9">Files</a></li>
<li><a class="reference internal" href="#navigation" id="id10">Navigation</a></li>
<li><a class="reference internal" href="#filename-globbing" id="id11">Filename Globbing</a></li>
<li><a class="reference internal" href="#quoting" id="id12">Quoting</a></li>
<li><a class="reference internal" href="#basic-utilities" id="id13">Basic utilities</a></li>
<li><a class="reference internal" href="#streams-pipes-and-redirects" id="id14">Streams, Pipes, and Redirects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regular-expressions" id="id15">Regular Expressions</a><ul>
<li><a class="reference internal" href="#overview-and-core-syntax" id="id16">Overview and core syntax</a></li>
<li><a class="reference internal" href="#character-sets-and-character-classes" id="id17">Character sets and character classes</a></li>
<li><a class="reference internal" href="#location-specific-matches" id="id18">Location-specific matches</a></li>
<li><a class="reference internal" href="#repetitions-grouping-and-references" id="id19">Repetitions, Grouping, and References</a></li>
<li><a class="reference internal" href="#greedy-matching" id="id20">Greedy matching</a></li>
<li><a class="reference internal" href="#ed-grep-sed-awk-and-perl" id="id21"><code class="docutils literal"><span class="pre">ed</span></code>, <code class="docutils literal"><span class="pre">grep</span></code>, <code class="docutils literal"><span class="pre">sed</span></code>, <code class="docutils literal"><span class="pre">awk</span></code>, and <code class="docutils literal"><span class="pre">perl</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#processes" id="id22">Processes</a><ul>
<li><a class="reference internal" href="#monitoring" id="id23">Monitoring</a></li>
<li><a class="reference internal" href="#signaling" id="id24">Signaling</a></li>
<li><a class="reference internal" href="#job-control" id="id25">Job Control</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shell-programming" id="id26">Shell programming</a><ul>
<li><a class="reference internal" href="#functions" id="id27">Functions</a></li>
<li><a class="reference internal" href="#if-then-else" id="id28">If/then/else</a></li>
<li><a class="reference internal" href="#for-loops" id="id29">For loops</a></li>
<li><a class="reference internal" href="#how-much-shell-scripting-should-i-learn" id="id30">How much shell scripting should I learn?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-documents" id="id31">Working with documents</a></li>
<li><a class="reference internal" href="#exercises" id="id32">Exercises</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Some of the material in this tutorial was adapted from Chris Paciorek&#8217;s
<a class="reference external" href="https://github.com/berkeley-stat243/stat243-fall-2014/blob/master/units/unit2-bash.pdf">2014 Statistics 243 lecture notes on Bash</a>
and his <a class="reference external" href="https://github.com/berkeley-stat243/stat243-fall-2014/blob/master/units/unit4-usingR.pdf">2014 Statistics 243 lecture notes on using R</a>.</p>
<p class="last">Before reading this, you will want to be familiar with the material in
the &#8220;Basics of UNIX&#8221; tutorial and screencast here:
<a class="reference external" href="http://statistics.berkeley.edu/computing/training/tutorials">http://statistics.berkeley.edu/computing/training/tutorials</a></p>
</div>
<div class="section" id="the-interactive-shell">
<h2><a class="toc-backref" href="#id3">The Interactive Shell</a><a class="headerlink" href="#the-interactive-shell" title="Permalink to this headline">¶</a></h2>
<p>The shell is an interactive computer programming environment. More
specifically, it is a read-evaluate-print loop (REPL) environment.  R and
Python also provide REPL environments. A REPL reads a single <em>expression</em> or
input, parses and <em>evaluates</em> it, <em>prints</em> the results, and then <em>loops</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">I will use a <code class="docutils literal"><span class="pre">$</span></code> prompt for bash, a <code class="docutils literal"><span class="pre">&gt;</span></code> prompt for R, and a <code class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></code>
for Python, and a <code class="docutils literal"><span class="pre">In</span> <span class="pre">[1]:</span></code> prompt for IPython. By convention, a
regular user&#8217;s prompt in bash is <code class="docutils literal"><span class="pre">$</span></code>, while the root (or administrative)
user&#8217;s prompt is <code class="docutils literal"><span class="pre">#</span></code>.  However, it is common practice to never log
on as the root user.  If you need to run a command with root privileges,
you should use the <code class="docutils literal"><span class="pre">sudo</span></code> command (see the <em>Getting started</em> section
below for more details).</p>
</div>
<p>When you are working in a terminal window (i.e., a window with the command line
interface), you&#8217;re interacting with a shell.  There are multiple shells (e.g.,
<em>sh</em>, <em>bash</em>, <em>csh</em>, <em>tcsh</em>, <em>zsh</em>, <em>fish</em>).  I&#8217;ll assume you are using <em>bash</em>,
as this is the default for Mac OS X, the BCE VM, the SCF machines and most
Linux distributions.  However, the basic ideas are applicable to any Unix
shell.</p>
<p>The shell is an amazingly powerful programming environment.
From it you can interactively monitor and control almost any aspect of the OS
and more importantly you can automate it. As you will see, <strong>bash</strong> has a very
extensive set of capabilities intended to make both interactive as well as
automated control simple, effective, and customizable.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It can be difficult to distinguish what is shell-specific and
what is just part of UNIX. Some of the material here is not
bash-specific but general to UNIX.</p>
<p class="last">Reference: Newham and Rosenblatt, Learning the bash Shell, 2nd ed.</p>
</div>
<div class="section" id="getting-started">
<h3><a class="toc-backref" href="#id4">Getting started</a><a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<p>I assume you already have access to a basic bash shell on a computer with
network access.  You should also have ssh installed.  SSH provides an encrypted
mechanism to connect to a remote Unix terminal. To learn more about using
ssh to connect to the SCF machines and general tips about using ssh on various
operating systems, see: <a class="reference external" href="http://statistics.berkeley.edu/computing/ssh">http://statistics.berkeley.edu/computing/ssh</a></p>
<p>To ssh to another machine, you need to know its (host)name.  For example, to
ssh to <code class="docutils literal"><span class="pre">scf-ug01.berkeley.edu</span></code>, one of the SCF machines, you would:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ssh scf-ug01.berkeley.edu
Password:
</pre></div>
</div>
<p>At this point you have to type your password.  Alternatively, you can
set up ssh so that you can use it without typing your password.  To
learn how to set this up, see: <a class="reference external" href="http://statistics.berkeley.edu/computing/ssh-keys">http://statistics.berkeley.edu/computing/ssh-keys</a></p>
<p>If you have a different username on SCF machines, you will need to specify
it as well.  For example, to specify the username <code class="docutils literal"><span class="pre">jarrod</span></code>, you would:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ssh jarrod@scf-ug01.berkeley.edu
</pre></div>
</div>
<p>If you want to view graphical applications on your local computer that are
running on the remote computer you need to use the <code class="docutils literal"><span class="pre">-X</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ssh -X jarrod@scf-ug01.berkeley.edu
</pre></div>
</div>
<p>Alternatively, if you want to copy a file (<code class="docutils literal"><span class="pre">file1.txt</span></code>) from your local
computer to <code class="docutils literal"><span class="pre">scf-ug01.berkeley.edu</span></code>, you can use the <code class="docutils literal"><span class="pre">scp</span></code> command,
which securely copies files between machines:</p>
<div class="highlight-python"><div class="highlight"><pre>$ scp file1.txt jarrod@scf-ug01.berkeley.edu:.
</pre></div>
</div>
<p>The above command will copy <code class="docutils literal"><span class="pre">file1.txt</span></code> from my current working directory
on my local machine to <code class="docutils literal"><span class="pre">jarrod</span></code>&#8216;s home directory on <code class="docutils literal"><span class="pre">scf-ug01.berkeley.edu</span></code>.
The <code class="docutils literal"><span class="pre">.</span></code> following the <code class="docutils literal"><span class="pre">:</span></code> indicates that I want to copy the file to
my home directory on the remote machine.  I could also replace <code class="docutils literal"><span class="pre">.</span></code> with
any relative path from my home directory on the remote machine or I could
use an absolute path.</p>
<p>To copy a file (<code class="docutils literal"><span class="pre">file2.txt</span></code>) from <code class="docutils literal"><span class="pre">scf-ug01.berkeley.edu</span></code> to my local machine:</p>
<div class="highlight-python"><div class="highlight"><pre>$ scp jarrod@scf-ug01.berkeley.edu:file2.txt .
</pre></div>
</div>
<p>I can even copy a file (<code class="docutils literal"><span class="pre">file3.txt</span></code>) owned by one user (<code class="docutils literal"><span class="pre">jarrod</span></code>) on one remote
machine <code class="docutils literal"><span class="pre">scf-ug01.berkeley.edu</span></code> to the account of another user (<code class="docutils literal"><span class="pre">jmillman</span></code>) on
another remote machine <code class="docutils literal"><span class="pre">scf-ug02.berkeley.edu</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ scp jarrod@scf-ug01.berkeley.edu:file3.txt jmillman@scf-ug01.berkeley.edu:.
</pre></div>
</div>
<p>If instead of copying a single file, I wanted to copy an entire directory
(<code class="docutils literal"><span class="pre">src</span></code>) from one machine to another, I would use the <code class="docutils literal"><span class="pre">-r</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre>$ scp -r src jmillman@scf-ug01.berkeley.edu:.
</pre></div>
</div>
<p>Regardless of whether you are working on a local computer or a remote one, it
is occasionally useful to operate as a different user.  For instance, you may
need root (or administrative) access to change file permissions or install
software.</p>
<p>To upgrade all the software on your BCE machine:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo apt-get upgrade
</pre></div>
</div>
<p>To install the text editor <cite>vim</cite> on a BCE machine:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo apt-get install vim
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Most bash commands have electronic manual pages, which are accessible
directly from the commandline.  You will be more efficient and effective
if you become accustomed to using these <code class="docutils literal"><span class="pre">man</span></code> pages.  To view the <code class="docutils literal"><span class="pre">man</span></code>
page for the command <code class="docutils literal"><span class="pre">sudo</span></code>, for instance, you would type:</p>
<div class="highlight-python"><div class="highlight"><pre>$ man sudo
</pre></div>
</div>
<p class="last">Compare this output to the this <a class="reference internal" href="../commands/sudo.html#sudo"><span>sudo</span></a> page.</p>
</div>
</div>
<div class="section" id="variables">
<h3><a class="toc-backref" href="#id5">Variables</a><a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>Much of how bash behaves can be customized through the use of variables,
which consists of names that have values assigned to them.  To access
the value currently assigned to a variable, you can prepend the name
with the dollar sign ($).  To print the value you can use the <code class="docutils literal"><span class="pre">echo</span></code>
command.</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">What is my default shell?</div>
<div class="line"><code class="docutils literal"><span class="pre">$</span> <span class="pre">echo</span> <span class="pre">$SHELL</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">To change to bash on a one-time basis:</div>
<div class="line"><code class="docutils literal"><span class="pre">$</span> <span class="pre">bash</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">To make it your default:</div>
<div class="line"><code class="docutils literal"><span class="pre">$</span> <span class="pre">chsh</span> <span class="pre">/bin/bash</span></code></div>
</div>
</li>
</ol>
<p>In the last example, <code class="docutils literal"><span class="pre">/bin/bash</span></code> should be whatever the path to the bash shell
is, which you can figure out using <code class="docutils literal"><span class="pre">which</span> <span class="pre">bash</span></code>.</p>
<p>To declare a variable, just assign a value to its reference.
For example, if you want to make a new variable with the name
<code class="docutils literal"><span class="pre">counter</span></code> with the value <code class="docutils literal"><span class="pre">1</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ counter=1
</pre></div>
</div>
<p>Since bash uses spaces to parse the expression you give it as input,
it is important to note the lack of spaces around the equal sign.
Try typing the command with and without spaces and note what happens.</p>
<p>You can also enclose the variable name in curly brackets, which comes in
handy when you&#8217;re embedding a variable within a line of code to make sure
the shell knows where the variable name ends:</p>
<div class="highlight-python"><div class="highlight"><pre>$ base=/home/jarrod/
$ echo $basesrc
$ echo ${base}src
</pre></div>
</div>
<p>Make sure you understand the difference in behavior in the last two lines.</p>
<p>There are also special shell variables called environment variables that help
to control the shell&#8217;s behavior. These are generally named in all caps. Type
<code class="docutils literal"><span class="pre">printenv</span></code> to see them. You can create your own environment variable as
follows:</p>
<div class="highlight-python"><div class="highlight"><pre>$ export base=/home/jarrod/
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">export</span></code> command ensures that other shells created by the current shell
(for example, to run a program) will inherit the variable.  Without the export
command, any shell variables that are set will only be modified within the
current shell. More generally, if you want a variable to always be accessible,
you should include the definition of the variable with an <code class="docutils literal"><span class="pre">export</span></code> command in
your <code class="docutils literal"><span class="pre">.bashrc</span></code> file.</p>
<p>You can control the appearance of the bash prompt using the <code class="docutils literal"><span class="pre">PS1</span></code>
variable:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo $PS1
</pre></div>
</div>
<p>To modify it so that it puts the username, hostname, and current working
directory in the prompt:</p>
<div class="highlight-python"><div class="highlight"><pre>$ export PS1=&#39;[\u@\h \W]\$ &#39;
[user1@local1 ~]$
</pre></div>
</div>
</div>
<div class="section" id="commands">
<h3><a class="toc-backref" href="#id6">Commands</a><a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h3>
<p>While each command has its own syntax, there are some rules usually
followed. Generally, a command line consists of 4 things: a command,
command options, arguments, and line acceptance.  Consider the following
example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls -l file.txt
</pre></div>
</div>
<p>In the above example, <code class="docutils literal"><span class="pre">ls</span></code> is the command, <code class="docutils literal"><span class="pre">-l</span></code> is a command option
specifying to use the long format, <code class="docutils literal"><span class="pre">file.txt</span></code> is the argument, and the
line acceptance is indicated by hitting the <code class="docutils literal"><span class="pre">Enter</span></code> key at the end
of the line.</p>
<p>After you type a command at the bash prompt and indicate line acceptance with
the <code class="docutils literal"><span class="pre">Enter</span></code> key, bash parses the command and then attempts to execute the
command.  To determine what to do, bash first checks whether the command is a
shell function (we will discuss functions below).  If not, it checks to see
whether it is a builtin.  Finally, if the command is not a shell function nor a
builtin, bash uses the <code class="docutils literal"><span class="pre">PATH</span></code> variable.  The <code class="docutils literal"><span class="pre">PATH</span></code> variable is a list of
directories:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo $PATH
/home/jarrod/usr/bin:/usr/local/bin:/bin:/usr/bin:
</pre></div>
</div>
<p>For example, consider the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep pdf file.txt
</pre></div>
</div>
<p>We will discuss <code class="docutils literal"><span class="pre">grep</span></code> later.  For now, let&#8217;s ignore what <code class="docutils literal"><span class="pre">grep</span></code> actually does
and focus on what bash would do when you press enter after typing the above
command.  First bash checks whether <code class="docutils literal"><span class="pre">grep</span></code> a shell function or a builtin.
Once it determines that <code class="docutils literal"><span class="pre">grep</span></code> is neither a shell function nor a builtin,
it will look for an executable file named <code class="docutils literal"><span class="pre">grep</span></code> first in <code class="docutils literal"><span class="pre">/home/jarrod/usr/bin</span></code>,
then in <code class="docutils literal"><span class="pre">/usr/local/bin</span></code>, and so on until it finds a match or runs out of places
to look.  You can use <code class="docutils literal"><span class="pre">which</span></code> to find out where bash would find it:</p>
<div class="highlight-python"><div class="highlight"><pre>$ which grep
/bin/grep
</pre></div>
</div>
<p><strong>Exercise</strong></p>
<p>Consider the following examples using the <code class="docutils literal"><span class="pre">ls</span></code> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls --all -l
$ ls -a -l
$ ls -al
</pre></div>
</div>
<p>Use <code class="docutils literal"><span class="pre">man</span> <span class="pre">ls</span></code> to see what the command options do.  Is there any difference
in what the three versions of the command invocation above return as
the result?  What happens if you add a filename to the end of the command?</p>
<div class="section" id="tab-completion">
<h4>Tab completion<a class="headerlink" href="#tab-completion" title="Permalink to this headline">¶</a></h4>
<p>When working in the shell, it is often unnecessary to type out an entire
command or file name, because of a feature known as tab completion. When you
are entering a command or filename in the shell, you can, at any time, hit the
tab key, and the shell will try to figure out how to complete the name of the
command or filename you are typing. If there is only one command in the search
path and you&#8217;re using tab completion with the first token of a line, then the
shell will display its value and the cursor will be one space past the
completed name. If there are multiple commands that match the partial name, the
shell will display as much as it can. In this case, hitting tab twice will
display a list of choices, and redisplay the partial command line for further
editing. Similar behavior with regard to filenames occurs when tab completion
is used on anything other than the first token of a command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that R does tab completion for objects (including functions) and
filenames.  While the default Python shell does not perform tab completion,
the IPython shell does.</p>
</div>
</div>
<div class="section" id="command-history-and-editing">
<h4>Command History and Editing<a class="headerlink" href="#command-history-and-editing" title="Permalink to this headline">¶</a></h4>
<p>By using the up and down arrows, you can scroll through commands that
you have entered previously. So if you want to rerun the same command,
or fix a typo in a command you entered, just scroll up to it and hit
enter to run it or edit the line and then hit enter.</p>
<p>To list the history of the commands you entered, use the <code class="docutils literal"><span class="pre">history</span></code> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ history
  1    echo $PS1
  2    PS1=$
  3    bash
  4    export PS1=$
  5    bash
  6    echo $PATH
  7    which echo
  8    ls --all -l
  9    ls -a -l
  10   ls -al
  11   ls -al manual.xml
</pre></div>
</div>
<p>The behavior of the <code class="docutils literal"><span class="pre">history</span></code> command is controlled by a shell variables:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo $HISTFILE
$ echo $HISTSIZE
</pre></div>
</div>
<p>You can also rerun previous commands as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>$ !-n
$ !gi
</pre></div>
</div>
<p>The first example runs the nth previous command and the second one runs the
last command that started with &#8216;gi&#8217;.</p>
<p><strong>Table. Command History Expansion</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Designator</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">!!</span></code></td>
<td>Last command</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">!n</span></code></td>
<td>Command numbered <em>n</em> in the history</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">!-n</span></code></td>
<td>Command <em>n</em> previous</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">!string</span></code></td>
<td>Last command starting with <em>string</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">!?string</span></code></td>
<td>Last command containing <em>string</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">^string1^string2</span></code></td>
<td>Execute the previous command with <em>string2</em>
substituted for <em>string1</em></td>
</tr>
</tbody>
</table>
<p>If you&#8217;re not sure what command you&#8217;re going to recall, you can append
<code class="docutils literal"><span class="pre">:p</span></code> at the end of the text you type to do the recall, and the result
will be printed, but not executed. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ !gi:p
</pre></div>
</div>
<p>You can then use the up arrow key to bring back that statement for editing or
execution.</p>
<p>You can also search for commands by doing <code class="docutils literal"><span class="pre">Ctrl-r</span></code> and typing a string of
characters to search for in the search history. You can hit return to submit,
<code class="docutils literal"><span class="pre">Ctrl-c</span></code> to get out, or <code class="docutils literal"><span class="pre">ESC</span></code> to put the result on the regular command line
for editing.</p>
</div>
<div class="section" id="command-substitution">
<h4>Command Substitution<a class="headerlink" href="#command-substitution" title="Permalink to this headline">¶</a></h4>
<p>You may occasionally need to substitute the results of a command for use by
another command.  For example, if you wanted to use the directory listing
returned by <code class="docutils literal"><span class="pre">ls</span></code> as the argument to another command, you would type
<code class="docutils literal"><span class="pre">$(ls)</span></code> in the location you want the result of <code class="docutils literal"><span class="pre">ls</span></code> to appear.</p>
<p>An older notation for command substitution is to use backticks (e.g., <code class="docutils literal"><span class="pre">`ls`</span></code>
versus <code class="docutils literal"><span class="pre">$(ls)</span></code>).  It is generally preferable to use the new notation, since
there are many annoyances with the backtick notation.  For example, backslashes
(<code class="docutils literal"><span class="pre">\</span></code>) inside of backticks behave in a non-intuitive way, nested quoting is
more cumbersome inside backticks, nested substitution is more difficult inside
of backticks, and it is easy to visually mistake backticks for a single quote.</p>
<p><strong>Exercise</strong></p>
<p>Try the following commands:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls -l tr
$ which tr
$ ls -l which tr
$ ls -l $(which tr)
</pre></div>
</div>
<p>Make sure you understand why each command behaves as it does.</p>
</div>
</div>
<div class="section" id="shortcuts">
<h3><a class="toc-backref" href="#id7">Shortcuts</a><a class="headerlink" href="#shortcuts" title="Permalink to this headline">¶</a></h3>
<div class="section" id="aliases-command-shortcuts">
<h4>Aliases &#8211; command shortcuts<a class="headerlink" href="#aliases-command-shortcuts" title="Permalink to this headline">¶</a></h4>
<p>Aliases allow you to use an abbreviation for a command, to create new
functionality or to insure that certain options are always used when you
call an existing command. For example, I&#8217;m lazy and would rather type
<code class="docutils literal"><span class="pre">q</span></code> instead of <code class="docutils literal"><span class="pre">exit</span></code> to terminate a shell window. You could create
the alias as follow:</p>
<div class="highlight-python"><div class="highlight"><pre>$ alias q=exit
</pre></div>
</div>
<p>As another example, suppose you find the <code class="docutils literal"><span class="pre">-F</span></code> option of <code class="docutils literal"><span class="pre">ls</span></code> (which
displays <code class="docutils literal"><span class="pre">/</span></code> after directories, <code class="docutils literal"><span class="pre">\</span></code> after executable files
and <code class="docutils literal"><span class="pre">&#64;</span></code> after links) to be very useful. The command</p>
<div class="highlight-python"><div class="highlight"><pre>$ alias ls=&quot;ls -F&quot;
</pre></div>
</div>
<p>will insure that the <code class="docutils literal"><span class="pre">-F</span></code> option will be used whenever you use <code class="docutils literal"><span class="pre">ls</span></code>.
If you need to use the unaliased version of something for which you&#8217;ve
created an alias, precede the name with a backslash (<code class="docutils literal"><span class="pre">\</span></code>). For
example, to use the normal version of <code class="docutils literal"><span class="pre">ls</span></code> after you&#8217;ve created the
alias described above:</p>
<div class="highlight-python"><div class="highlight"><pre>$ \ls
</pre></div>
</div>
<p>The real power of aliases is only achieved when they are automatically
set up whenever you log in to the computer or open a new shell window.
To achieve that goal with aliases (or any other bash shell commands),
simply insert the commands in the file <code class="docutils literal"><span class="pre">.bashrc</span></code> in your home directory.
For example, here is an excerpt from my <code class="docutils literal"><span class="pre">.bashrc</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre># .bashrc

# Source global definitions
if [ -f /etc/bashrc ]; then
        . /etc/bashrc
fi

# User specific aliases and functions
pushdp () {
 pushd &quot;$(python -c &quot;import os.path as _, ${1}; \
   print _.dirname(_.realpath(${1}.__file__[:-1]))&quot;
 )&quot;
}

export EDITOR=vim
source /usr/share/git-core/contrib/completion/git-prompt.sh
export PS1=&#39;[\u@\h \W$(__git_ps1 &quot; (%s)&quot;)]\$ &#39;

# history settings
export HISTCONTROL=ignoredups   # no duplicate entries
shopt -s histappend             # append, don&#39;t overwrite

# R settings
export R_LIBS=$HOME/usr/lib64/R/library
alias R=&quot;/usr/bin/R --quiet --no-save&quot;

# Set path
mybin=$HOME/usr/bin
export PATH=$mybin:$HOME/.local/bin:$HOME/usr/local/bin:$PATH:
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/usr/local/lib

# Additional aliases
alias grep=&#39;grep --color=auto&#39;
alias hgrep=&#39;history | grep&#39;
alias l.=&#39;ls -d .* --color=auto&#39;
alias ll=&#39;ls -l --color=auto&#39;
alias ls=&#39;ls --color=auto&#39;
alias more=less
alias vi=vim
alias which=&#39;(alias; declare -f) | /usr/bin/which --tty-only \
         --read-alias --read-functions --show-tilde --show-dot&#39;
</pre></div>
</div>
<p><strong>Exercise</strong></p>
<p>Look over the content of the example <code class="docutils literal"><span class="pre">.bashrc</span></code> and make sure you understand
what each line does.  For instance, use <code class="docutils literal"><span class="pre">man</span> <span class="pre">grep</span></code> to see what the option
<code class="docutils literal"><span class="pre">--color=auto</span></code> does.  Use <code class="docutils literal"><span class="pre">man</span> <span class="pre">which</span></code> to figure out what the various
options passed to it do.</p>
</div>
<div class="section" id="keyboard-shortcuts">
<h4>Keyboard shortcuts<a class="headerlink" href="#keyboard-shortcuts" title="Permalink to this headline">¶</a></h4>
<p>Note that you can use emacs-like control sequences (<code class="docutils literal"><span class="pre">Ctrl-a</span></code>, <code class="docutils literal"><span class="pre">Ctrl-e</span></code>,
<code class="docutils literal"><span class="pre">Ctrl-k</span></code>) to navigate and delete characters.</p>
<p><strong>Table. Keyboard Shortcuts</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key Strokes</th>
<th class="head">Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Ctrl-a</span></code></td>
<td>Beginning of line</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Ctrl-e</span></code></td>
<td>End of file</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Ctrl-k</span></code></td>
<td>Delete line from cursor forward</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Ctrl-d</span></code></td>
<td>EOF; exit</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Ctrl-c</span></code></td>
<td>Interrupt current command</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Ctrl-z</span></code></td>
<td>Suspend current command</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Ctrl-l</span></code></td>
<td>Clear screen</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="basic-file-management">
<h2><a class="toc-backref" href="#id8">Basic File Management</a><a class="headerlink" href="#basic-file-management" title="Permalink to this headline">¶</a></h2>
<p>In Unix, almost &#8220;everything is a file.&#8221; This means that a very wide variety
of input and output resources (e.g., documents, directories, keyboards,
harddrives, network devices) are streams of bytes available through the
filesystem interface. This means that the basic file management tools
are extremely powerful in Unix.  Not only can you use these tools to work
with files, but you can also use them to monitor and control many aspects
of your computer.</p>
<div class="section" id="files">
<h3><a class="toc-backref" href="#id9">Files</a><a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h3>
<p>A file typically consist of these attributes:</p>
<ul class="simple">
<li>Name.</li>
<li>Type.</li>
<li>Location.</li>
<li>Size.</li>
<li>Protection.</li>
<li>Time, date, and user identification.</li>
</ul>
<div class="figure" id="id1">
<a class="reference internal image-reference" href="../_images/file.png"><img alt="Schematic of file attributes." src="../_images/file.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-text">Schematic of file attributes.</span></p>
</div>
<p>Listing file attributes with <code class="docutils literal"><span class="pre">ls</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls -l
</pre></div>
</div>
<p>Getting more information with <code class="docutils literal"><span class="pre">stat</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ stat manual.xml
</pre></div>
</div>
<p>Finding out what type of file you have:</p>
<div class="highlight-python"><div class="highlight"><pre>$ file manual.xml
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The <code class="docutils literal"><span class="pre">file</span></code> command relies on many sources
of information to determine what a file contains. The easiest part
to explain is <em>magic</em>. Specifically, the <code class="docutils literal"><span class="pre">file</span></code> command examines
the content of the file and compares it with information found in
the <code class="docutils literal"><span class="pre">/usr/share/magic/</span></code> directory.</p>
</div>
<p>Changing file attributes with <code class="docutils literal"><span class="pre">chmod</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ chmod g+w manual.xml
</pre></div>
</div>
<p>For more detailed information, please see the &#8220;Basics of UNIX&#8221; tutorial and
screencast here: <a class="reference external" href="http://statistics.berkeley.edu/computing/training/tutorials">http://statistics.berkeley.edu/computing/training/tutorials</a></p>
</div>
<div class="section" id="navigation">
<h3><a class="toc-backref" href="#id10">Navigation</a><a class="headerlink" href="#navigation" title="Permalink to this headline">¶</a></h3>
<p>Efficient navigation of the filesystem from the shell is an essential aspect of
mastering Unix.  Use <code class="docutils literal"><span class="pre">pwd</span></code> to list your current working directory.  If you
just enter <code class="docutils literal"><span class="pre">cd</span></code> at a prompt, your current working directory will change to
your home directory.  You can also refer to your home directory using the tilde
<code class="docutils literal"><span class="pre">~</span></code>.  For example, if you wanted to change your current directory to the
subdirectory <code class="docutils literal"><span class="pre">src</span></code> in your home directory from any other current directory,
you could type:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd ~/src
</pre></div>
</div>
<p>Also if you want to return to the previous directory, you could type:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd -
</pre></div>
</div>
<p>You can use the <a class="reference internal" href="../commands/pushd.html#pushd"><span>pushd</span></a>, <a class="reference internal" href="../commands/popd.html#popd"><span>popd</span></a>, and <a class="reference internal" href="../commands/dirs.html#dirs"><span>dirs</span></a> commands if you would
like to keep a stack of previous working directories rather than just
the last one.</p>
</div>
<div class="section" id="filename-globbing">
<h3><a class="toc-backref" href="#id11">Filename Globbing</a><a class="headerlink" href="#filename-globbing" title="Permalink to this headline">¶</a></h3>
<p>Shell file globbing will expand certain special characters (called wildcards)
to match patterns of filenames, before passing those filenames on to a program.
Note that the programs themselves don&#8217;t know anything about wildcards; it is
the shell that does the expansion, so that programs don&#8217;t see the wildcards.
The following table shows some of the special characters that the shell uses
for expansion.</p>
<p><strong>Table. Filename wildcards</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Wildcard</th>
<th class="head">Function</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">*</span></code></td>
<td>Match zero or more characters.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">?</span></code></td>
<td>Match exactly one character.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[characters]</span></code></td>
<td>Match any single character from among <em>characters</em>
listed between brackets.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[!characters]</span></code></td>
<td>Match any single character other than <em>characters</em>
listed between brackets.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[a-z]</span></code></td>
<td>Match any single character from among the range of
characters listed between brackets.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[!a-z]</span></code></td>
<td>Match any single character from among the characters
not in the range listed between brackets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">{frag1,frag2,...}</span></code></td>
<td>Brace expansion: create strings frag1, frag2, etc.</td>
</tr>
</tbody>
</table>
<p>List all files ending with a digit:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls *[0-9]
</pre></div>
</div>
<p>Make a copy of <code class="docutils literal"><span class="pre">filename</span></code> as <code class="docutils literal"><span class="pre">filename.old</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp filename{,.old}
</pre></div>
</div>
<p>Remove all files beginning with <em>a</em> or <em>z</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm [az]*
</pre></div>
</div>
<p>List all the R code files with a variety of suffixes:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls *.{r,q,R}
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">echo</span></code> command can be used to verify that a wildcard expansion will
do what you think it will:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo cp filename{,.old}
cp filename filename.old
</pre></div>
</div>
<p>If you want to suppress the special meaning of a wildcard in a shell command,
precede it with a backslash (<code class="docutils literal"><span class="pre">\</span></code>). Note that this is a general rule of thumb
in many similar situations when a character has a special meaning but you just
want to treat it as a character.</p>
<p>To read more about standard globbing patterns, see the man page:</p>
<div class="highlight-python"><div class="highlight"><pre>$ man 7 glob
</pre></div>
</div>
<p><strong>Exercise</strong></p>
<p>Brace expansion is quite useful and more flexible than I&#8217;ve indicated.
Above we saw how to use brace expansion using a comma comma separated
list of items inside the curly braces (e.g., <code class="docutils literal"><span class="pre">{r,q,R}</span></code>), but they
can also be used with a sequence specification.  A sequence is indicated
with a start and end item separated by two periods (<code class="docutils literal"><span class="pre">..</span></code>).  Try typing
the following examples at the command line and try to figure out how they
work:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo {1..15}
$ echo {a{1..3},b{1..5},c{c..e}}
$ echo {{d..a},{a..d}}
$ echo {{d..b},a,{b..d}}
$ echo {1..5..2}
$ echo {z..a..-2}
</pre></div>
</div>
</div>
<div class="section" id="quoting">
<h3><a class="toc-backref" href="#id12">Quoting</a><a class="headerlink" href="#quoting" title="Permalink to this headline">¶</a></h3>
<p><strong>Table. Quotes</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Types of Quoting</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'</span> <span class="pre">'</span></code></td>
<td>hard quote - no substitution allowed</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">&quot;</span> <span class="pre">&quot;</span></code></td>
<td>soft quote - allow substitution</td>
</tr>
</tbody>
</table>
<p>Finally, a note about using single vs. double quotes in shell code. In general,
variables inside double quotes will be evaluated, but variables not inside
double quotes will not be:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo &quot;$HOME&quot;
/home/jarrod
$ echo &#39;$HOME&#39;
$HOME
</pre></div>
</div>
<p>This can be useful, for example, when you have a directory with a space in its
name (of course, it is better to avoid spaces in file and directory names).
Since bash uses spaces to parse the elements of the command line, you might
try escaping the spaces with a backslash:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls $HOME/with\ space
ls: cannot access /home/jarrod/with space: No such file or directory
</pre></div>
</div>
<p>You could fix this error by using triple backslashes, but a cleaner approach
is to use soft (or double) quotes:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls &quot;$HOME/with\ space&quot;
file1.txt
</pre></div>
</div>
<p>If you used hard quotes, you will get this error:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls &#39;$HOME/with\ space&#39;
ls: cannot access $HOME/with\ space: No such file or directory
</pre></div>
</div>
<p>What if you have double quotes in your file or directory name (again, it is
better to avoid using double quotes in file and directory names)? In this
case, you will need to escape the quote:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls &quot;$HOME/\&quot;with\&quot;quote&quot;
</pre></div>
</div>
<p>So we&#8217;ll generally use double quotes. We can always work with a literal
double quote by escaping it as seen above.</p>
</div>
<div class="section" id="basic-utilities">
<h3><a class="toc-backref" href="#id13">Basic utilities</a><a class="headerlink" href="#basic-utilities" title="Permalink to this headline">¶</a></h3>
<p>Since files are such an essential aspect of Unix and working from the shell is
the primary way to work with Unix, there are a large number of useful commands
and tools to view and manipulate files.</p>
<ul class="simple">
<li><a class="reference internal" href="../commands/cat.html#cat"><span>cat</span></a> &#8211;&nbsp;concatenate files and print on the standard output</li>
<li><a class="reference internal" href="../commands/cp.html#cp"><span>cp</span></a>&#8211;&nbsp;copy files and directories</li>
<li><a class="reference internal" href="../commands/cut.html#cut"><span>cut</span></a> &#8211; remove sections from each line of files</li>
<li><a class="reference internal" href="../commands/diff.html#diff"><span>diff</span></a>&#8211;&nbsp;find differences between two files</li>
<li><a class="reference internal" href="../commands/grep.html#grep"><span>grep</span></a> &#8211;&nbsp;print lines matching a pattern</li>
<li><a class="reference internal" href="../commands/head.html#head"><span>head</span></a> &#8211;&nbsp;output the first part of files</li>
<li><a class="reference internal" href="../commands/find.html#find"><span>find</span></a> &#8211;&nbsp; search for files in a directory hierarchy</li>
<li><a class="reference internal" href="../commands/less.html#less"><span>less</span></a> &#8211;&nbsp;opposite of more</li>
<li><a class="reference internal" href="../commands/more.html#more"><span>more</span></a> &#8211;&nbsp; file perusal filter for crt viewing</li>
<li><a class="reference internal" href="../commands/mv.html#mv"><span>mv</span></a> &#8211;&nbsp;move (rename) files</li>
<li><a class="reference internal" href="../commands/nl.html#nl"><span>nl</span></a> &#8211;&nbsp;number lines of files</li>
<li><a class="reference internal" href="../commands/paste.html#paste"><span>paste</span></a> &#8211;&nbsp;merge lines of files</li>
<li><a class="reference internal" href="../commands/rm.html#rm"><span>rm</span></a> &#8211;&nbsp;remove files or directories</li>
<li><a class="reference internal" href="../commands/rmdir.html#rmdir"><span>rmdir</span></a> &#8211;&nbsp;remove empty directories</li>
<li><a class="reference internal" href="../commands/sort.html#sort"><span>sort</span></a> &#8211;&nbsp;sort lines of text files.</li>
<li><a class="reference internal" href="../commands/split.html#split"><span>split</span></a> &#8211;&nbsp;split a file into pieces</li>
<li><a class="reference internal" href="../commands/tac.html#tac"><span>tac</span></a> &#8211;&nbsp;concatenate and print files in reverse</li>
<li><a class="reference internal" href="../commands/tail.html#tail"><span>tail</span></a> &#8211;&nbsp;output the last part of files</li>
<li><a class="reference internal" href="../commands/touch.html#touch"><span>touch</span></a> &#8211;&nbsp;change file timestamps</li>
<li><a class="reference internal" href="../commands/tr.html#tr"><span>tr</span></a> &#8211;&nbsp;translate or delete characters</li>
<li><a class="reference internal" href="../commands/uniq.html#uniq"><span>uniq</span></a> &#8211;&nbsp; remove duplicate lines from a sorted file</li>
<li><a class="reference internal" href="../commands/wc.html#wc"><span>wc</span></a> &#8211;&nbsp; print the number of bytes, words, and lines in files</li>
<li><a class="reference internal" href="../commands/wget.html#wget"><span>wget</span></a> and <code class="docutils literal"><span class="pre">curl</span></code> &#8211;&nbsp;non-interactive network downloader</li>
</ul>
<p>As we&#8217;ve already seen the general syntax for a Unix program is:</p>
<div class="highlight-python"><div class="highlight"><pre>$ command -options argument1 argument2 ...
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep -i graphics file.txt
</pre></div>
</div>
<p>looks for the literal string <code class="docutils literal"><span class="pre">graphics</span></code> (argument 1) in <code class="docutils literal"><span class="pre">file.txt</span></code>
(argument2) with the option <code class="docutils literal"><span class="pre">-i</span></code>, which says to ignore the case of the
letters. While</p>
<div class="highlight-python"><div class="highlight"><pre>$ less file.txt
</pre></div>
</div>
<p>simply pages through a text file (you can navigate up and down) so you
can get a feel for what&#8217;s in it.  To exit <code class="docutils literal"><span class="pre">less</span></code> type <code class="docutils literal"><span class="pre">q</span></code>.</p>
<p>To find files by name, modification time, and type:</p>
<div class="highlight-python"><div class="highlight"><pre>$ find . -name &#39;*.txt&#39;  # find files named *.txt
$ find . -mtime -2      # find files modified less than 2 days ago
$ find . -type l        # find links
</pre></div>
</div>
<p>Unix programs often take options that are identified with a minus
followed by a letter, followed by the specific option (adding a space
before the specific option is fine). Options may also involve two
dashes, e.g., <code class="docutils literal"><span class="pre">R</span> <span class="pre">--no-save</span></code>. A standard two dash option for many commands
is <code class="docutils literal"><span class="pre">--help</span></code>.  For example, try:</p>
<div class="highlight-python"><div class="highlight"><pre>$ tail --help
</pre></div>
</div>
<p>Here are a couple of examples of using the <code class="docutils literal"><span class="pre">tail</span></code> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ wget http://jarrodmillman.com/rcsds/data/cpds.csv
$ tail -n 10 cpds.csv   # last 10 lines of cpds.csv
$ tail -f cpds.csv      # shows end of file, continually refreshing
</pre></div>
</div>
<p>The first line downloads the data from my website.  The two main tools for
downloading network accessible data from the commandline are <code class="docutils literal"><span class="pre">wget</span></code> and
<code class="docutils literal"><span class="pre">curl</span></code>.  I tend to use <code class="docutils literal"><span class="pre">wget</span></code> as my commandline downloading tool as it
is more convenient.</p>
<p>A few more tidbits about <code class="docutils literal"><span class="pre">grep</span></code> (we will see more examples of <code class="docutils literal"><span class="pre">grep</span></code> in the
section on regular expressions, but it is so useful that it is worth seeing
many times):</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep ^2001 cpds.csv   # returns lines that start with &#39;2001&#39;
$ grep 0$ cpds.csv      # returns lines that end with &#39;0&#39;
$ grep 19.0 cpds.csv    # returns lines with &#39;19&#39; separated from &#39;0&#39; by a single character
$ grep 19.*0 cpds.csv   # now separated by any number of characters
$ grep -o 19.0 cpds.csv # returns only the content matching the pattern from the relevant lines
</pre></div>
</div>
<p>Note that the first argument to grep is the pattern you are looking for.
The syntax is different from that used for wildcards in file names.
Also, you can use regular expressions in the pattern. We won’t see this
in detail here, but will discuss this in the section below on regular
expressions.</p>
<p>It is sometimes helpful to put the pattern inside double quotes, e.g.,
if you want spaces in your pattern:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep &quot;George .* Bush&quot; cpds.csv
</pre></div>
</div>
<p>More generally in Unix, enclosing a string in quotes is often useful to
indicate that it is a single argument/value.</p>
<p>If you want to explicitly look for one of the special characters used in
creating patterns (such as double quote (<code class="docutils literal"><span class="pre">&quot;</span></code>), period (<code class="docutils literal"><span class="pre">.</span></code>), etc., you
can &#8220;escape&#8221; them by preceding with a back-slash. For example to look
for <code class="docutils literal"><span class="pre">&quot;Canada&quot;</span></code>, including the quotes:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep &quot;\&quot;Canada\&quot;&quot; cpds.csv
</pre></div>
</div>
<p>If you have a big data file and need to subset it by line (e.g., with
<code class="docutils literal"><span class="pre">grep</span></code>) or by field (e.g., with <code class="docutils literal"><span class="pre">cut</span></code>), then you can do it really fast
from the Unix command line, rather than reading it with R, SAS, Python,
etc.</p>
<p>Much of the power of these utilities comes in piping between them (see
the next section) and using wildcards (see the section on Globbing) to operate
on groups of files. The utilities can also be used in shell scripts to do more
complicated things.</p>
<p>We will look at several examples of how to use these utilities below, but first
let&#8217;s discuss streams and redirection.</p>
<p><strong>Exercise</strong></p>
<p>You&#8217;ve already seen some of the above commands.  Follow the links above and
while you are reading the abbreviated man pages consider how you might use
these commands.</p>
</div>
<div class="section" id="streams-pipes-and-redirects">
<h3><a class="toc-backref" href="#id14">Streams, Pipes, and Redirects</a><a class="headerlink" href="#streams-pipes-and-redirects" title="Permalink to this headline">¶</a></h3>
<p>Unix programs that involve input and/or output often operate by reading input
from a stream known as standard input (<em>stdin</em>), and writing their results to a
stream known as standard output (<em>stdout</em>). In addition, a third stream known
as standard error (<em>stderr</em>) receives error messages and other information
that&#8217;s not part of the program&#8217;s results. In the usual interactive session,
standard output and standard error default to your screen, and standard input
defaults to your keyboard.</p>
<p>You can change the place from which programs read and write through
redirection.  The shell provides this service, not the individual programs, so
redirection will work for all programs. The following table shows some examples
of redirection.</p>
<p><strong>Table. Common Redirection Operators</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Redirection Syntax</th>
<th class="head">Function</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">&gt;</span> <span class="pre">file</span></code></td>
<td>Send <em>stdout</em> to <em>file</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">1&gt;</span> <span class="pre">file</span></code></td>
<td>Same as above</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">2&gt;</span> <span class="pre">file</span></code></td>
<td>Send <em>stderr</em> to <em>file</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">&gt;</span> <span class="pre">file</span> <span class="pre">2&gt;&amp;1</span></code></td>
<td>Send both <em>stdout</em> and <em>stderr</em> to <em>file</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">&lt;</span> <span class="pre">file</span></code></td>
<td>Receive <em>stdin</em> from <em>file</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">&gt;&gt;</span> <span class="pre">file</span></code></td>
<td>Append <em>stdout</em> to <em>file</em>:</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">1&gt;&gt;</span> <span class="pre">file</span></code></td>
<td>Same as above</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">2&gt;&gt;</span> <span class="pre">file</span></code></td>
<td>Append <em>stderr</em> to <em>file</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd</span> <span class="pre">&gt;&gt;</span> <span class="pre">file</span> <span class="pre">2&gt;&amp;1</span></code></td>
<td>Append both <em>stdout</em> and <em>stderr</em> to <em>file</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd1</span> <span class="pre">|</span> <span class="pre">cmd2</span></code></td>
<td>Pipe <em>stdout</em> from <em>cmd1</em> to <em>cmd2</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd1</span> <span class="pre">2&gt;&amp;1</span> <span class="pre">|</span> <span class="pre">cmd2</span></code></td>
<td>Pipe <em>stdout</em> and <em>stderr</em> from <em>cmd1</em> to <em>cmd2</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">$</span> <span class="pre">cmd1</span> <span class="pre">tee</span> <span class="pre">file1</span> <span class="pre">|</span> <span class="pre">cmd2</span></code></td>
<td>Pipe <em>stdout</em> and <em>cmd1</em> to <em>cmd2</em> while
simultaneously writing it to <em>file1</em>
using <em>tee</em></td>
</tr>
</tbody>
</table>
<p>Note that <code class="docutils literal"><span class="pre">cmd</span></code> may include options and arguments as seen in the previous
section.</p>
<div class="section" id="standard-redirection">
<h4>Standard Redirection<a class="headerlink" href="#standard-redirection" title="Permalink to this headline">¶</a></h4>
<p>Operations where output from one command is used as input to another command
(via the <code class="docutils literal"><span class="pre">|</span></code> operator) are known as pipes; they are made especially useful by
the convention that many UNIX commands will accept their input through the
standard input stream when no file name is provided to them.</p>
<p>A simple pipe to <code class="docutils literal"><span class="pre">wc</span></code> to count the number of words in a string:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo &quot;hey there&quot; | wc -w
2
</pre></div>
</div>
<p>Translating lowercase to UPPERCASE with <code class="docutils literal"><span class="pre">tr</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo &#39;user1&#39;  | tr &#39;a-z&#39; &#39;A-Z&#39;
USER1
</pre></div>
</div>
<p>Here&#8217;s an example of finding out how many unique entries there are in the 2nd
column of a data file whose fields are separated by commas:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cut -d&#39;,&#39; -f2 cpds.csv | sort | uniq | wc
$ cut -d&#39;,&#39; -f2 cpds.csv | sort | uniq &gt; countries.txt
</pre></div>
</div>
<p>Above we use the <code class="docutils literal"><span class="pre">cut</span></code> utility to extract the second field (<code class="docutils literal"><span class="pre">-f2</span></code>) or
column of the file <code class="docutils literal"><span class="pre">cpds.csv</span></code> where the fields (or columns) are split or
delimited by a comma (<code class="docutils literal"><span class="pre">-d','</span></code>). The standard output of the <code class="docutils literal"><span class="pre">cut</span></code> command is
then piped (via <code class="docutils literal"><span class="pre">|</span></code>) to the standard input of the <code class="docutils literal"><span class="pre">sort</span></code> command.  Then the
output of <code class="docutils literal"><span class="pre">sort</span></code> is sent to the input of <code class="docutils literal"><span class="pre">uniq</span></code> to remove duplicate entries
in the sorted list provided by <code class="docutils literal"><span class="pre">sort</span></code>. Rather than using <code class="docutils literal"><span class="pre">sort</span> <span class="pre">|</span> <span class="pre">uniq</span></code>, you
could also use <code class="docutils literal"><span class="pre">sort</span> <span class="pre">-u</span></code>.  Finally, the first of the  <code class="docutils literal"><span class="pre">cut</span></code> commands prints
a word count summary using <code class="docutils literal"><span class="pre">wc</span></code>; while the second saving the sorted
information with duplicates removed in the file <code class="docutils literal"><span class="pre">countries.txt</span></code>.</p>
<p>To see if there are any &#8220;S&#8221; values in certain fields (fixed width) of a set of
files (note I did this on 22,000 files (5 Gb or so) in about 5 minutes on my
desktop; it would have taken much more time to read the data into R):</p>
<div class="highlight-python"><div class="highlight"><pre>$ cut -b29,37,45,53,61,69,77,85,93,101,109,117,125,133,141,149, \
        157,165,173,181,189,197,205,213,221,229,237,245,253, \
        261,269 USC*.dly | grep S | less
</pre></div>
</div>
<p>A closely related, but subtly different, capability that we saw above is
command substitution. Recall that when the shell encounters a command
surrounded by <code class="docutils literal"><span class="pre">$()</span></code> (or backticks), it runs the command and replaces the
expression with the output from the command; this allows something
similar to a pipe, but is appropriate when a command reads its arguments
directly from the command line instead of through standard input. For example,
suppose we are interested in searching for the text <code class="docutils literal"><span class="pre">pdf</span></code> in the last 4 R code
files (those with suffix <code class="docutils literal"><span class="pre">.r</span></code> or <code class="docutils literal"><span class="pre">.R</span></code>) that were modified in the current
directory. We can find the names of the last 4 files ending in <code class="docutils literal"><span class="pre">.R</span></code> or <code class="docutils literal"><span class="pre">.r</span></code>
which were modified using:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls -t *.{R,r} | head -4
</pre></div>
</div>
<p>and we can search for the required pattern using <code class="docutils literal"><span class="pre">grep</span></code> (we will discuss
<code class="docutils literal"><span class="pre">grep</span></code> again in the section on regular expressions). Putting these
together with the backtick operator we can solve the problem using:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep pdf $(ls -t *.{R,r} | head -4)
</pre></div>
</div>
<p>Note that piping the output of the <code class="docutils literal"><span class="pre">ls</span></code> command into <code class="docutils literal"><span class="pre">grep</span></code> would not
achieve the desired goal, since <code class="docutils literal"><span class="pre">grep</span></code> reads its filenames from the
command line, not standard input.</p>
</div>
<div class="section" id="the-xargs-and-tee-commands">
<h4>The <code class="docutils literal"><span class="pre">xargs</span></code> and <code class="docutils literal"><span class="pre">tee</span></code> commands<a class="headerlink" href="#the-xargs-and-tee-commands" title="Permalink to this headline">¶</a></h4>
<p>You can also redirect output as the arguments to another program using
the <code class="docutils literal"><span class="pre">xargs</span></code> utility. Here&#8217;s an example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls -t *.{R,r} | head -4 | xargs grep pdf
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">tee</span></code> command let&#8217;s you create 2 streams from 1. For example, consider
the case where you want the results of this command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cut -d&#39;,&#39; -f2 cpds.csv | sort | uniq
</pre></div>
</div>
<p>to both be output to the terminal screen you are working in as well
as being saved to a file.  You could issue the command twice:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cut -d&#39;,&#39; -f2 cpds.csv | sort | uniq
$ cut -d&#39;,&#39; -f2 cpds.csv | sort | uniq &gt; countries.txt
</pre></div>
</div>
<p>Instead of repeating the command and wasting computing time, you could use
<code class="docutils literal"><span class="pre">tee</span></code> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cut -d&#39;,&#39; -f2 cpds.csv | sort | uniq | tee countries.txt
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="regular-expressions">
<h2><a class="toc-backref" href="#id15">Regular Expressions</a><a class="headerlink" href="#regular-expressions" title="Permalink to this headline">¶</a></h2>
<p>Regular expressions (regex) are a domain-specific language for finding patterns
and are one of the key functionalities in scripting languages such as Perl and
Python, as well as the UNIX utilities <code class="docutils literal"><span class="pre">sed</span></code>, <code class="docutils literal"><span class="pre">awk</span></code>, and <code class="docutils literal"><span class="pre">grep</span></code> as we will
see below. I&#8217;ll just cover the basic use of regular expressions in bash, but
once you know that, it would be easy to use them elsewhere (Python, R, etc.).
At the level we&#8217;ll consider them, the syntax is quite similar.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">POSIX.2 regular expressions come in two flavors: extended regular expressions
and basic (or obsolete) regular expressions.  The extended syntax has metacharacters
<code class="docutils literal"><span class="pre">()</span></code> and <code class="docutils literal"><span class="pre">{}</span></code>, while the basic syntax requires the metacharacters have
to be designated <code class="docutils literal"><span class="pre">\(\)</span></code> and <code class="docutils literal"><span class="pre">\{\}</span></code>.  In addition to the POSIX standard,
Perl regular expressions are also widely used.  While we won&#8217;t go into
detail, we will see some examples of each syntax.</p>
</div>
<div class="section" id="overview-and-core-syntax">
<h3><a class="toc-backref" href="#id16">Overview and core syntax</a><a class="headerlink" href="#overview-and-core-syntax" title="Permalink to this headline">¶</a></h3>
<p>The basic idea of regular expressions is that they allow us to find matches of
strings or patterns in strings, as well as do substitution.  Regular
expressions are good for tasks such as:</p>
<ul class="simple">
<li>extracting pieces of text - for example finding all the links in an
html document;</li>
<li>creating variables from information found in text;</li>
<li>cleaning and transforming text into a uniform format;</li>
<li>mining text by treating documents as data; and</li>
<li>scraping the web for data.</li>
</ul>
<p>Regular expressions are constructed from three things:</p>
<ol class="arabic simple">
<li><em>Literal characters</em> are matched only by the characters themselves,</li>
<li><em>Character classes</em> are matched by any single member in the class, and</li>
<li><em>Modifiers</em> operate on either of the above or combinations of them.</li>
</ol>
<p>Note that the syntax is very concise, so it&#8217;s helpful to break down individual
regular expressions into the component parts to understand them. Since regex
are their own language, it&#8217;s a good idea to build up a regex in pieces as a
way of avoiding errors just as we would with any computer code. It is also
helpful to search for common regex online before trying to craft your own.
For instance, if you wanted to use a regex that matches valid email addresses,
you would need to match anything that complies with the <a class="reference external" href="http://www.ietf.org/rfc/rfc0822.txt?number=822">RFC 822</a> grammar. If you look over that
document, you will quickly realize that implementing a correct regular expression
to validate email addresses is extremely complex. So if you are writing a website
that validates email addresses, it is best to look for a bug-vetted implementation
rather than creating your own.</p>
<p>The special characters (meta-characters) used for defining regular expressions
are:</p>
<div class="highlight-python"><div class="highlight"><pre>* . ^ $ + ? ( ) [ ] { } | \
</pre></div>
</div>
<p>To use these characters literally as characters, we have to &#8216;escape&#8217; them. In
bash, you escape these characters by placing a  single backslash before the
character you want to escape.  In R, we have to use two backslashes instead of
a single backslash because R uses a single backslash to symbolize certain
control characters, such as <code class="docutils literal"><span class="pre">\n</span></code> for newline.</p>
</div>
<div class="section" id="character-sets-and-character-classes">
<h3><a class="toc-backref" href="#id17">Character sets and character classes</a><a class="headerlink" href="#character-sets-and-character-classes" title="Permalink to this headline">¶</a></h3>
<p><strong>Character sets</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operators</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[abc]</span></code></td>
<td>Match any single character from from the listed characters</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[a-z]</span></code></td>
<td>Match any single character from the range of characters</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[^abc]</span></code></td>
<td>Match any single character not among listed characters</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[^a-z]</span></code></td>
<td>Match any single character not among listed range of characters</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">.</span></code></td>
<td>Match any single character except a <em>newline</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">\</span></code></td>
<td>Turn off (escape) the special meaning of a metacharacter</td>
</tr>
</tbody>
</table>
<p>If we want to search for any one of a set of characters, we use a
character set, such as <code class="docutils literal"><span class="pre">[13579]</span></code> or <code class="docutils literal"><span class="pre">[abcd]</span></code> or <code class="docutils literal"><span class="pre">[0-9]</span></code> (where the
dash indicates a sequence) or <code class="docutils literal"><span class="pre">[0-9a-z]</span></code>. To indicate any
character not in a set, we place a <code class="docutils literal"><span class="pre">^</span></code> just inside the first bracket:
<code class="docutils literal"><span class="pre">[^abcd]</span></code>.</p>
<p>There are a bunch of named character classes so that we don&#8217;t have write out
common sets of characters. The syntax is <code class="docutils literal"><span class="pre">[:CLASS:]</span></code> where <code class="docutils literal"><span class="pre">CLASS</span></code> is one of
the following values:</p>
<div class="highlight-python"><div class="highlight"><pre>&quot;alnum&quot;, &quot;alpha&quot;, &quot;ascii&quot;, &quot;blank&quot;, &quot;cntrl&quot;, &quot;digit&quot;, &quot;graph&quot;,
&quot;lower&quot;, &quot;print&quot;, &quot;punct&quot;, &quot;space&quot;, &quot;upper&quot;, &quot;word&quot; or &quot;xdigit&quot;.
</pre></div>
</div>
<p>To learn more about regular expressions, you can type:</p>
<div class="highlight-python"><div class="highlight"><pre>$ man 7 regex
</pre></div>
</div>
<p>To make a character set with a character class you
need two square brackets, e.g. the digit class: <code class="docutils literal"><span class="pre">[[:digit:]]</span></code>. Or we
can make a combined character set such as <code class="docutils literal"><span class="pre">[[:alnum:]_]</span></code>.</p>
</div>
<div class="section" id="location-specific-matches">
<h3><a class="toc-backref" href="#id18">Location-specific matches</a><a class="headerlink" href="#location-specific-matches" title="Permalink to this headline">¶</a></h3>
<p><strong>Position anchors</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operators</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">^</span></code></td>
<td>Match the beginning of a line.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">$</span></code></td>
<td>Match the end of a line.</td>
</tr>
</tbody>
</table>
<p>To find a pattern at the beginning of the string, we use <code class="docutils literal"><span class="pre">^</span></code> (note this was
also used for negation, but in that case occurs only inside square brackets)
and to find it at the end we use <code class="docutils literal"><span class="pre">$</span></code>.</p>
</div>
<div class="section" id="repetitions-grouping-and-references">
<h3><a class="toc-backref" href="#id19">Repetitions, Grouping, and References</a><a class="headerlink" href="#repetitions-grouping-and-references" title="Permalink to this headline">¶</a></h3>
<p>Now suppose I wanted to be able to detect phone numbers, email addresses, etc.
I often need to be able to deal with repetitions of character sets.</p>
<p><strong>Modifiers</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operators</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">*</span></code></td>
<td>Match zero or more of the character that precedes it.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">?</span></code></td>
<td>Match zero or one instance of the preceding <em>regex</em>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">+</span></code></td>
<td>Match one or more instances of the preceding <em>regex</em>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">{n,m}</span></code></td>
<td>Match a range of occurrences of the single character or <em>regex</em>
that precedes this construct.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">|</span></code></td>
<td>Match the character or expression to the left or right of the
vertical bar.</td>
</tr>
</tbody>
</table>
<p>I can indicate repetitions as indicated in these examples:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">[[:digit:]]*</span></code> – any number of digits (zero or more)</li>
<li><code class="docutils literal"><span class="pre">[[:digit:]]+</span></code> – at least one digit</li>
<li><code class="docutils literal"><span class="pre">[[:digit:]]?</span></code> – zero or one digits</li>
<li><code class="docutils literal"><span class="pre">[[:digit:]]{1,3}</span></code> – at least one and no more than three digits</li>
<li><code class="docutils literal"><span class="pre">[[:digit:]]{2,}</span></code> – two or more digits</li>
</ul>
<p>An example is that <code class="docutils literal"><span class="pre">\[.*\]</span></code> is the pattern of closed square brackets
with any number of characters (<code class="docutils literal"><span class="pre">.*</span></code>) inside.</p>
<p>We often want to be able to look for multi-character patterns.  For example,
if you wanted to match phone numbers whether they start with <code class="docutils literal"><span class="pre">1-</span></code> or not
you could use the following:</p>
<div class="highlight-python"><div class="highlight"><pre>(1-)?[[:digit:]]{3}-[[:digit:]]{4}
</pre></div>
</div>
<p>The first part of the pattern <code class="docutils literal"><span class="pre">(1-)?</span></code> matches 0 or 1 occurrences of <code class="docutils literal"><span class="pre">1-</span></code>.
Then the pattern <code class="docutils literal"><span class="pre">[[:digit:]]{3}</span></code> matches any 3 digits. Similarly, the
pattern <code class="docutils literal"><span class="pre">[[:digit:]]{4}</span></code> matches any 4 digits. So the whole pattern
matches any three digits followed by <code class="docutils literal"><span class="pre">-</span></code> and then followed by four
digits when it is preceded by 0 or 1 occurrences of <code class="docutils literal"><span class="pre">1-</span></code>.</p>
<p>Parentheses are also used with a pipe (<code class="docutils literal"><span class="pre">|</span></code>) to indicate any one of a set of
multi-character sequences, such as <code class="docutils literal"><span class="pre">(http|ftp)</span></code>.</p>
</div>
<div class="section" id="greedy-matching">
<h3><a class="toc-backref" href="#id20">Greedy matching</a><a class="headerlink" href="#greedy-matching" title="Permalink to this headline">¶</a></h3>
<p>Regular expression pattern matching is <em>greedy</em>&#8212;by default, the longest
matching string is chosen.</p>
<p>Suppose we have the following file:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cat file1.txt
Do an internship &lt;b&gt; in place &lt;/b&gt; of &lt;b&gt; one &lt;/b&gt; course.
</pre></div>
</div>
<p>If we want to match the html tags (e.g., <code class="docutils literal"><span class="pre">&lt;b&gt;</span></code> and <code class="docutils literal"><span class="pre">&lt;/b&gt;</span></code>, we might
be tempted to use the pattern <code class="docutils literal"><span class="pre">&lt;.*&gt;</span></code>.  Using the <code class="docutils literal"><span class="pre">-o</span></code> option to grep,
we can have grep print out just the part of the text that the pattern
matches:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep -o &quot;&lt;.*&gt;&quot; file1.txt
&lt;b&gt; in place &lt;/b&gt; of &lt;b&gt; one &lt;/b&gt;
</pre></div>
</div>
<p>To get a non-greedy match, you can use the modifier <code class="docutils literal"><span class="pre">?</span></code> after the
quantifier. However, this requires that we use the Perl syntax.  In order for
grep to use the Perl syntax, we need to use the <code class="docutils literal"><span class="pre">-P</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep -P -o &quot;&lt;.*?&gt;&quot; file1.txt
&lt;b&gt;
&lt;/b&gt;
&lt;b&gt;
&lt;/b&gt;
</pre></div>
</div>
<p>However, one can often avoid greedy matching by being more clever.</p>
<p><strong>Challenge</strong>: How could we change our regexp to avoid the greedy
matching without using the <code class="docutils literal"><span class="pre">?</span></code> modifier?  Hint: Is there some
character set that we don&#8217;t want to be inside the angle brackets?</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><strong>Globs vs. Regex:</strong>
Be sure you understand the difference between filename globbing (see
the Section called <em>Filename Globbing</em>) and regular expressions.
Filename globbing only works for filenames, while regular expressions
are used to match patterns in text more generally.  While they both
use the same set of symbols, they mean different things (e.g., <code class="docutils literal"><span class="pre">*</span></code>
matches 0 or more characters when globbing but matches 0 or more
repetitions of the character that precedes it when used in a regular
expression).</p>
</div>
</div>
<div class="section" id="ed-grep-sed-awk-and-perl">
<h3><a class="toc-backref" href="#id21"><code class="docutils literal"><span class="pre">ed</span></code>, <code class="docutils literal"><span class="pre">grep</span></code>, <code class="docutils literal"><span class="pre">sed</span></code>, <code class="docutils literal"><span class="pre">awk</span></code>, and <code class="docutils literal"><span class="pre">perl</span></code></a><a class="headerlink" href="#ed-grep-sed-awk-and-perl" title="Permalink to this headline">¶</a></h3>
<p>Before the text editor, there was the line editor.  Rather than presenting you
with the entire text as a text editor does, a line editor only displays lines
of text when it is requested to.  The original Unix line editor is called <code class="docutils literal"><span class="pre">ed</span></code>.
You will likely never use <code class="docutils literal"><span class="pre">ed</span></code> directly, but you will very likely use commands
that are its descendants.  For example, the commands <code class="docutils literal"><span class="pre">grep</span></code>, <code class="docutils literal"><span class="pre">sed</span></code>, <code class="docutils literal"><span class="pre">awk</span></code>,
and <code class="docutils literal"><span class="pre">vim</span></code> are all based directly on <code class="docutils literal"><span class="pre">ed</span></code> (e.g., <code class="docutils literal"><span class="pre">grep</span></code> is a <code class="docutils literal"><span class="pre">ed</span></code> command
that is now available as a standalone command, while <code class="docutils literal"><span class="pre">sed</span></code> is a streaming
version of <code class="docutils literal"><span class="pre">ed</span></code>) or inherit much of its syntax (e.g., <code class="docutils literal"><span class="pre">awk</span></code> and <code class="docutils literal"><span class="pre">vim</span></code>
both heavily borrow from the <code class="docutils literal"><span class="pre">ed</span></code> syntax).  Since <code class="docutils literal"><span class="pre">ed</span></code> was written when
computing resources were very constrained compared to today, this means that
the syntax of these commands can be terse.  However, it also means that learning
the syntax for one of these tools will be rewarded when you need to learn the
syntax of another of these tools.</p>
<div class="section" id="grep">
<h4><code class="docutils literal"><span class="pre">grep</span></code><a class="headerlink" href="#grep" title="Permalink to this headline">¶</a></h4>
<p>The simplest of these tools is <code class="docutils literal"><span class="pre">grep</span></code>.  As I mentioned, <code class="docutils literal"><span class="pre">ed</span></code> only displays
lines of text when requested.  One common task was to print all the lines in
a file matching a specific regular expression.  The command in <code class="docutils literal"><span class="pre">ed</span></code> that
does this is <code class="docutils literal"><span class="pre">g/&lt;re&gt;/p</span></code>, which stands for globally match all lines containing
the regular express <code class="docutils literal"><span class="pre">&lt;re&gt;</span></code> and print them out.</p>
<p>To start you will need to create a file called <code class="docutils literal"><span class="pre">file1.txt</span></code> with the following
content:</p>
<div class="highlight-python"><div class="highlight"><pre>This is the first line.
Followed by a this line.
And then ...
</pre></div>
</div>
<p>To print all the lines containing <code class="docutils literal"><span class="pre">is</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep is file1.txt
This is the first line.
Followed by a this line.
</pre></div>
</div>
<p>To print all the lines <strong>not</strong> containing <code class="docutils literal"><span class="pre">is</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep -v is file1.txt
And then ...
</pre></div>
</div>
<p>Now let&#8217;s consider a file named <code class="docutils literal"><span class="pre">file2.txt</span></code> with the following
content:</p>
<div class="highlight-python"><div class="highlight"><pre>Here&#39;s my number: 919-543-3300.
hi John, good to meet you
They bought 731 bananas
Please call 1.919.554.3800
I think he said it was 337.4355
</pre></div>
</div>
<p>Let&#8217;s use the pattern from the section above to print all lines containing
phone numbers:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep  &#39;(1-)?[[:digit:]]{3}-[[:digit:]]{4}&#39; file2.txt
</pre></div>
</div>
<p>You will notice that this doesn&#8217;t match any lines.  The reason is that the
group syntax <code class="docutils literal"><span class="pre">(1-)</span></code> and the <code class="docutils literal"><span class="pre">{}</span></code> notation are not part of the extended
syntax.  To have <code class="docutils literal"><span class="pre">grep</span></code> use the extended syntax, you can either use the
<code class="docutils literal"><span class="pre">-E</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep -E &#39;(1-)?[[:digit:]]{3}-[[:digit:]]{4}&#39; t.t
Here&#39;s my number: 919-543-3300.
</pre></div>
</div>
<p>or use the <code class="docutils literal"><span class="pre">egrep</span></code> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ egrep  &#39;(1-)?[[:digit:]]{3}-[[:digit:]]{4}&#39; t.t
Here&#39;s my number: 919-543-3300.
</pre></div>
</div>
<p>If we want to match regardless of whether the phone number is separated
by a minus <code class="docutils literal"><span class="pre">-</span></code> or a period <code class="docutils literal"><span class="pre">.</span></code>, we could use the pattern <code class="docutils literal"><span class="pre">[-.]</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ egrep  &#39;(1[-.])?[[:digit:]]{3}[-.][[:digit:]]{4}&#39; file2.txt
Here&#39;s my number: 919-543-3300.
Please call 1.919.554.3800
I think he said it was 337.4355
</pre></div>
</div>
<p><strong>Exercise</strong></p>
<p>Explain what the following regular expression matches:</p>
<div class="highlight-python"><div class="highlight"><pre>$ grep &#39;^[^T]*is.*$&#39; file1.txt
</pre></div>
</div>
</div>
<div class="section" id="sed-and-awk">
<h4><code class="docutils literal"><span class="pre">sed</span></code> and <code class="docutils literal"><span class="pre">awk</span></code><a class="headerlink" href="#sed-and-awk" title="Permalink to this headline">¶</a></h4>
<p>Printing lines of text with <code class="docutils literal"><span class="pre">sed</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sed -n &#39;1,9p&#39; file.txt       # prints out lines 1-9 of file.txt
$ sed -n &#39;/^#/p&#39; file.txt       # prints out lines starting with # of file.txt
</pre></div>
</div>
<p>The first command prints out lines 1-9 of <code class="docutils literal"><span class="pre">file.txt</span></code>, while the second one
prints out lines starting with <code class="docutils literal"><span class="pre">#</span></code> of <code class="docutils literal"><span class="pre">file.txt</span></code>.</p>
<p>Deleting lines of text with <code class="docutils literal"><span class="pre">sed</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sed -e &#39;1,9d&#39; file.txt
$ sed -e &#39;/^;/d&#39; -e &#39;/^$/d&#39; file.txt
</pre></div>
</div>
<p>The first line deletes lines 1-9 of <code class="docutils literal"><span class="pre">file.txt</span></code>. What do you think the second
line does?</p>
<p>Text substitution with <code class="docutils literal"><span class="pre">sed</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sed &#39;s/old_pattern/new_pattern/&#39; file.txt &gt; new_file.txt
$ sed &#39;s/old_pattern/new_pattern/g&#39; file.txt &gt; new_file.txt
</pre></div>
</div>
<p>The first line replaces only 1st instance in a line, while the second line
replaces all instances in a line (i.e., globally).</p>
<p>Awk is a general purpose programming language typically used in data extraction
tasks and particularly well-suited to one-liners (although it is possible to
write long programs in it, it is rare).  For our purposes, we will just look
at a few common one-liners to get a sense of how it works. Basically, awk
will go through a file line by line and perform some action for each line.</p>
<p>For example to double space a file, you would read each line, print it, and
then print a blank line:</p>
<div class="highlight-python"><div class="highlight"><pre>$ awk &#39;{ print } { print &quot;&quot; }&#39; file.txt
</pre></div>
</div>
<p>Print every line of a file that is longer than 80 characters:</p>
<div class="highlight-python"><div class="highlight"><pre>$ awk &#39;length($0) &gt; 80&#39; file.txt
</pre></div>
</div>
<p>Print the home directory of every user defined in the file <code class="docutils literal"><span class="pre">/etc/passwd</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ awk -F: &#39;{ print $6 }&#39; /etc/passwd
</pre></div>
</div>
<p>To see what this did, let&#8217;s look at the first line of <code class="docutils literal"><span class="pre">/etc/passwd</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ head -n 1 /etc/passwd
root:x:0:0:root:/root:/bin/bash
</pre></div>
</div>
<p>As you can see the entries are separated by colons (<code class="docutils literal"><span class="pre">:</span></code>) and the fifth
field contains the root user&#8217;s home directory (<code class="docutils literal"><span class="pre">/root</span></code>).  The option
<code class="docutils literal"><span class="pre">-F:</span></code> specifies that the colon <code class="docutils literal"><span class="pre">:</span></code> is the field delimiter and <code class="docutils literal"><span class="pre">print</span> <span class="pre">$6</span></code>
prints the 6th field of each line.</p>
<p>You don&#8217;t need to know much <code class="docutils literal"><span class="pre">sed</span></code> or <code class="docutils literal"><span class="pre">awk</span></code>, but it is good to know about
them since you can search the internet for awk or sed one-liners.  If you have
some file munging task, it can be helpful to do a quick search before writing
code to perform the task yourself.</p>
</div>
<div class="section" id="perl">
<h4><code class="docutils literal"><span class="pre">perl</span></code><a class="headerlink" href="#perl" title="Permalink to this headline">¶</a></h4>
<p>Perl is another general-purpose programming language that is particular
useful for one-liner commands to perform data extraction and manipulation
tasks.  Again even if you don&#8217;t learn how to program in Perl, it can
be useful to have a couple one-liners in your toolbox.</p>
<p>Text substitution with <code class="docutils literal"><span class="pre">perl</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ perl -pi -e &#39;s/old_pattern/new_pattern/g&#39; file.txt
$ perl -pi -e &#39;s/old_pattern/new_pattern/g&#39; $(find . -name \*.html)
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">i</span></code> option tells <code class="docutils literal"><span class="pre">perl</span></code> to do the global substitution in place.
You can also substitute the <code class="docutils literal"><span class="pre">/</span></code> with another character. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ perl -pi -e &#39;s:old_pattern:new_pattern:g&#39; file.txt
</pre></div>
</div>
<p>Summing columns with <code class="docutils literal"><span class="pre">perl</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ perl -lane &#39;print $F[0] + $F[1]&#39; file.txt
</pre></div>
</div>
<p>This will sum columns 1 and 2 of <code class="docutils literal"><span class="pre">file.txt</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="processes">
<h2><a class="toc-backref" href="#id22">Processes</a><a class="headerlink" href="#processes" title="Permalink to this headline">¶</a></h2>
<p>A process is a program that is being executed.  Processes have the following
attributes:</p>
<ul class="simple">
<li>A lifetime.</li>
<li>A process ID (PID).</li>
<li>A user ID (UID).</li>
<li>A group ID (GID).</li>
<li>A parent process.</li>
<li>An environment.</li>
<li>A current working directory.</li>
</ul>
<div class="section" id="monitoring">
<h3><a class="toc-backref" href="#id23">Monitoring</a><a class="headerlink" href="#monitoring" title="Permalink to this headline">¶</a></h3>
<p>Examining subprocesses of your shell with <code class="docutils literal"><span class="pre">ps</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps
PID TTY          TIME CMD
19370 pts/3    00:00:00 bash
22846 pts/3    00:00:00 ps
</pre></div>
</div>
<p>Examining in more detail subprocesses of your shell with <code class="docutils literal"><span class="pre">ps</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -f
UID        PID  PPID  C STIME TTY          TIME CMD
jarrod   19370 19368  0 10:51 pts/3    00:00:00 bash
jarrod   22850 19370  0 14:57 pts/3    00:00:00 ps -f
</pre></div>
</div>
<p>Examining in more detail all processes on your computer:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 Aug21 ?        00:00:05 /usr/lib/systemd
root         2     0  0 Aug21 ?        00:00:00 [kthreadd]
root         3     2  0 Aug21 ?        00:00:07 [ksoftirqd/0]
root         5     2  0 Aug21 ?        00:00:00 [kworker/0:0H]
   &lt;snip&gt;
root     16210     1  0 07:19 ?        00:00:00 login -- jarrod
jarrod   16219 16210  0 07:19 tty1     00:00:00 -bash
jarrod   16361 16219  0 07:19 tty1     00:00:00 /bin/sh /bin/startx
   &lt;snip&gt;
</pre></div>
</div>
<p>You can use the <code class="docutils literal"><span class="pre">-u</span></code> option to see percent CPU and percent memory
used by each process.  You can use the <code class="docutils literal"><span class="pre">-o</span></code> option to provide
your own user-defined format; for example,</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -o pid,ni,pcpu,pmem,user,comm
  PID  NI %CPU %MEM USER     COMMAND
18124   0  0.0  0.0 jarrod   bash
22963   0  0.0  0.0 jarrod   ps
</pre></div>
</div>
<p>To see the hierarchical process structure, you can use the <code class="docutils literal"><span class="pre">pstree</span></code> command.</p>
<p>Examining processes with <code class="docutils literal"><span class="pre">top</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ top
top - 13:49:07 up  1:49,  3 users,  load average: 0.10, 0.15, 0.18
Tasks: 160 total,   1 running, 158 sleeping,   1 stopped,   0 zombie
%Cpu(s):  2.5 us, 0.5 sy, 0.0 ni, 96.9 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st
KiB Mem : 7893644 total, 5951552 free, 1085584 used,  856508 buff/cache
KiB Swap: 7897084 total, 7897084 free,       0 used. 6561548 avail Mem

  PID USER     PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
 1607 jarrod   20   0 2333568 974888 212944 S  12.5 12.4  11:10.67 firefox
 3366 jarrod   20   0  159828   4312   3624 R   6.2  0.1   0:00.01 top
    1 root     20   0  193892   8484   5636 S   0.0  0.1   0:01.78 systemd
</pre></div>
</div>
<p>To quit <code class="docutils literal"><span class="pre">top</span></code>, type <code class="docutils literal"><span class="pre">q</span></code>.</p>
</div>
<div class="section" id="signaling">
<h3><a class="toc-backref" href="#id24">Signaling</a><a class="headerlink" href="#signaling" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s see how to build up a command to kill firefox using some of the tools
we&#8217;ve seen.  First let&#8217;s pipe the output of <code class="docutils literal"><span class="pre">ps</span> <span class="pre">-e</span></code> to <code class="docutils literal"><span class="pre">grep</span></code> to select
the line corresponding to <code class="docutils literal"><span class="pre">firefox</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -e | grep firefox
16517 ?        00:10:03 firefox
</pre></div>
</div>
<p>We can now use <code class="docutils literal"><span class="pre">awk</span></code> to select the first column, which contains the process
ID corresponding to <code class="docutils literal"><span class="pre">firefox</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -e | grep firefox | awk &#39;{ print $1 }&#39;
16517
</pre></div>
</div>
<p>Finally, we can pipe this to the <code class="docutils literal"><span class="pre">kill</span></code> command using <code class="docutils literal"><span class="pre">xargs</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -e | grep firefox | awk &#39;{ print $1 }&#39; | xargs kill
</pre></div>
</div>
</div>
<div class="section" id="job-control">
<h3><a class="toc-backref" href="#id25">Job Control</a><a class="headerlink" href="#job-control" title="Permalink to this headline">¶</a></h3>
<p>When you run a command in a shell by simply typing its name, you are
said to be running in the foreground. When a job is running in the
foreground, you can&#8217;t type additional commands into that shell session,
but there are two signals that can be sent to the running job through
the keyboard. To interrupt a program running in the foreground, use
<code class="docutils literal"><span class="pre">Ctrl-c</span></code>; to quit a program, use <code class="docutils literal"><span class="pre">Ctrl-\</span></code>. While modern windowed systems
have lessened the inconvenience of tying up a shell with foreground
processes, there are some situations where running in the foreground is
not adequate.</p>
<p>The primary need for an alternative to foreground processing arises when
you wish to have jobs continue to run after you log off the computer. In
cases like this you can run a program in the background by simply
terminating the command with an ampersand (<code class="docutils literal"><span class="pre">&amp;</span></code>). However, before putting
a job in the background, you should consider how you will access its
results, since <em>stdout</em> is not preserved when you log off from the
computer. Thus, redirection (including redirection of <em>stderr</em>) is
essential when running jobs in the background. As a simple example,
suppose that you wish to run an R script, and you don&#8217;t want it to
terminate when you log off. (Note that this can also be done using
<code class="docutils literal"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">BATCH</span></code>, so this is primarily an illustration.)</p>
<div class="highlight-python"><div class="highlight"><pre>$ R --no-save &lt; code.R &gt; code.Rout 2&gt;&amp;1 &amp;
</pre></div>
</div>
<p>If you forget to put a job in the background when you first execute
it, you can do it while it&#8217;s running in the foreground in two steps.
First, suspend the job using the <code class="docutils literal"><span class="pre">Ctrl-z</span></code> signal. After receiving the
signal, the program will interrupt execution, but will still have
access to all files and other resources. Next, issue the <code class="docutils literal"><span class="pre">bg</span></code>
command, which will start the stopped job running in the background.</p>
<div class="section" id="listing-and-killing-jobs">
<h4>Listing and killing jobs<a class="headerlink" href="#listing-and-killing-jobs" title="Permalink to this headline">¶</a></h4>
<p>Since only foreground jobs will accept signals through the keyboard, if you
want to terminate a background job you must first determine the unique process
id (PID) for the process you wish to terminate through the use of the <code class="docutils literal"><span class="pre">ps</span></code>
command.</p>
<p>To see all processes owned by a specific user (e.g., <code class="docutils literal"><span class="pre">jarrod</span></code>), I can use
the <code class="docutils literal"><span class="pre">-U</span> <span class="pre">jarrod</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -U jarrod
</pre></div>
</div>
<p>If I want to get more information (e.g., <code class="docutils literal"><span class="pre">%CPU</span></code> and <code class="docutils literal"><span class="pre">%MEM</span></code>), I can use
add the <code class="docutils literal"><span class="pre">-u</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ps -U jarrod -u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START    TIME COMMAND
jarrod   16116 12.0  6.0 118804  5080 tty1     Ss   16:25  133:01 python
</pre></div>
</div>
<p>In this example, the <code class="docutils literal"><span class="pre">ps</span></code> output tells us that this python job has a PID of
<code class="docutils literal"><span class="pre">16116</span></code>, that it has been running for 133 minutes, is using 12%
of CPU and 6% of memory, and that it started at 16:25. You could
then issue the command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ kill 11998
</pre></div>
</div>
<p>or, if that doesn&#8217;t work:</p>
<div class="highlight-python"><div class="highlight"><pre>$ kill -9 11998
</pre></div>
</div>
<p>to terminate the job. Another useful command in this regard is
<code class="docutils literal"><span class="pre">killall</span></code>, which accepts a program name instead of a process id, and
will kill all instances of the named program:</p>
<div class="highlight-python"><div class="highlight"><pre>$ killall R
</pre></div>
</div>
<p>Of course, it will only kill the jobs that belong to you, so it will
not affect the jobs of other users. Note that the <code class="docutils literal"><span class="pre">ps</span></code> and <code class="docutils literal"><span class="pre">kill</span></code>
commands only apply to the particular computer on which they are
executed, not to the entire computer network. Thus, if you start a job
on one machine, you must log back into that same machine in order to
manage your job.</p>
</div>
<div class="section" id="monitoring-jobs-and-memory-use">
<h4>Monitoring jobs and memory use<a class="headerlink" href="#monitoring-jobs-and-memory-use" title="Permalink to this headline">¶</a></h4>
<p>As we saw above, the <code class="docutils literal"><span class="pre">top</span></code> command also allows you to monitor the jobs on the
system and in real-time. In particular, it&#8217;s useful for seeing how much of the
CPU and how much memory is being used, as well as figuring out a PID as an
alternative to <code class="docutils literal"><span class="pre">ps</span></code>. You can also renice jobs (see below) and kill jobs from
within top: just type <code class="docutils literal"><span class="pre">r</span></code> or <code class="docutils literal"><span class="pre">k</span></code>, respectively, and proceed from there.</p>
<p>One of the main things to watch out for is a job that is using close to
100% of memory and much less than 100% of CPU. What is generally
happening is that your program has run out of memory and is using
virtual memory on disk, spending most of its time writing to/from disk,
sometimes called <em>paging</em> or <em>swapping</em>. If this happens, it can be a
very long time, if ever, before your job finishes.</p>
</div>
<div class="section" id="nicing-a-job">
<h4>Nicing a job<a class="headerlink" href="#nicing-a-job" title="Permalink to this headline">¶</a></h4>
<p>The most important thing to remember when starting a job on a machine that is
not your personal machine is how to be a good citizen. This often involves
&#8216;nicing&#8217; your jobs.  Nicing a job puts it at a lower priority so that a user
working at the keyboard has higher priority in using the CPU. Here&#8217;s how to do
it, giving the job a low priority of 19:</p>
<div class="highlight-python"><div class="highlight"><pre>$ nice -19 R CMD BATCH --no-save code.R code.Rout &amp;
</pre></div>
</div>
<p>If you forget and just submit the job without nicing, you can reduce
the priority by doing:</p>
<div class="highlight-python"><div class="highlight"><pre>$ renice +19 11998
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">11998</span></code> is the PID of your job.</p>
</div>
<div class="section" id="screen">
<h4>Screen<a class="headerlink" href="#screen" title="Permalink to this headline">¶</a></h4>
<p>Screen allows you to create virtual terminals, which are not connected to your
actual terminal or shell.  This allows you to run multiple programs from the
commandline and leave them all in the foreground in their own virtual terminal.
Screen provides facilities for managing several virtual terminals including
listing them, switching between them, disconnecting from one machine and then
reconnecting from another.  While we will only discuss its basic operation, we
will cover enough to be of regular use.</p>
<p>Calling screen</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen
</pre></div>
</div>
<p>will open a single window and you will see a new bash prompt.  You just work
at this prompt as you normally would.  The difference is that you can disconnect
from this window by typing <code class="docutils literal"><span class="pre">Ctrl-a</span> <span class="pre">d</span></code> and you will see something like this</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen
[detached from 23974.pts-2.t430u]
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">All the screen key commands begin with the control key combination <code class="docutils literal"><span class="pre">Ctrl-a</span></code>
followed by another key.  For instance, when you are in a screen session and
type <code class="docutils literal"><span class="pre">Ctrl-a</span> <span class="pre">?</span></code>, screen will display a help screen with a list of its
keybindings.</p>
</div>
<p>You can now list your screen sessions</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen -ls
There is a screen on:
        23974.pts-2.t430u       (Detached)
</pre></div>
</div>
<p>To reconnect</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen -r
</pre></div>
</div>
<p>You can start multiple screen sessions.  This is what it might look like
if you have 3 screen sessions:</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen -ls
There are screens on:
        24274.pts-2.t430u       (Attached)
        24216.pts-2.t430u       (Detached)
        24158.pts-2.t430u       (Detached)
</pre></div>
</div>
<p>To specify that you want to reattach to session <code class="docutils literal"><span class="pre">24158.pts-2.t430u</span></code>, type:</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen -r 24158.pts-2.t430u
</pre></div>
</div>
<p>If you have several screen sessions, you will want to name your screen session
something more informative than  <code class="docutils literal"><span class="pre">24158.pts-2.t430u</span></code>. To
name a screen session <code class="docutils literal"><span class="pre">gene-analysis</span></code> you can use the <code class="docutils literal"><span class="pre">-S</span></code> option when calling
screen:</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen -S gene-analysis
</pre></div>
</div>
<p>While there are many more features and keybindings available for screen, you&#8217;ve
already seen enough screen to be useful.  For example, imagine you ssh to a
remote machine from your laptop to run an analysis.  The first thing you do at
the bash prompt on the remote machine is:</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen -S dbox-study
</pre></div>
</div>
<p>Then you start your analysis script <code class="docutils literal"><span class="pre">dbox-analysis.py</span></code> running:</p>
<div class="highlight-python"><div class="highlight"><pre>$ dbox-analysis.py
Starting statistical analysis ...
Processing subject 1 ...
Processing subject 2 ...
</pre></div>
</div>
<p>If your study has 50 subjects and processing each subject takes 20 minutes,
you will not want to sit there watching your monitor.  So you use <code class="docutils literal"><span class="pre">Ctrl-a</span> <span class="pre">d</span></code>
to detach the session and you will then see:</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen -S dbox-study
[detached from 2799.dbox-study]
$
</pre></div>
</div>
<p>Now you can log off your laptop and go home.  Sometime after dinner, you decide
to check on your job.  So you ssh from your home computer to the remote machine
again and type the following at the bash prompt:</p>
<div class="highlight-python"><div class="highlight"><pre>$ screen -r dbox-study
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="shell-programming">
<h2><a class="toc-backref" href="#id26">Shell programming</a><a class="headerlink" href="#shell-programming" title="Permalink to this headline">¶</a></h2>
<p>Shell scripts are files containing shell commands (commonly with the extension
<code class="docutils literal"><span class="pre">.sh</span></code>) To run a shell script called <code class="docutils literal"><span class="pre">file.sh</span></code>, you would type</p>
<div class="highlight-python"><div class="highlight"><pre>$ source ./file.sh
</pre></div>
</div>
<p>or</p>
<div class="highlight-python"><div class="highlight"><pre>$ . ./file.sh
</pre></div>
</div>
<p>Note that if you just typed <code class="docutils literal"><span class="pre">file.sh</span></code>, the operating system will generally
have trouble finding the script and recognizing that it is executable. To be
sure that the operating system knows what shell to use to interpret the script,
the first line of the script should be <code class="docutils literal"><span class="pre">#!/bin/bash</span></code> (in the case that you&#8217;re
using the bash shell). Also, if you set <code class="docutils literal"><span class="pre">file.sh</span></code> to be executable (i.e., to
have the &#8216;x&#8217; flag set) you can execute it by just typing <code class="docutils literal"><span class="pre">./file.sh</span></code>.</p>
<div class="section" id="functions">
<h3><a class="toc-backref" href="#id27">Functions</a><a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p>You can define your own utilities by creating a shell function. This
allows you to automate things that are more complicated than you can do
with an alias. One nice thing about shell functions is that the shell
automatically takes care of function arguments for you. It places the
arguments given by the user into local variables in the function called
(in order): <code class="docutils literal"><span class="pre">$1</span> <span class="pre">$2</span> <span class="pre">$3</span></code> etc. It also fills <code class="docutils literal"><span class="pre">$#</span></code> with the number of
arguments given by the user. Here&#8217;s an example of using arguments in a
function that saves me some typing when I want to copy a file to the SCF
filesystem:</p>
<div class="highlight-python"><div class="highlight"><pre>function putscf() {
   scp $1 jarrod@scf-ug02.berkeley.edu:$2
}
</pre></div>
</div>
<p>To use this function, I just do the following to copy <code class="docutils literal"><span class="pre">unit1.pdf</span></code> from
the current directory on whatever non-SCF machine I&#8217;m on to the
directory <code class="docutils literal"><span class="pre">~/teaching/243</span></code> on SCF:</p>
<div class="highlight-python"><div class="highlight"><pre>$ putscf unit1.pdf ~/teaching/243/.
</pre></div>
</div>
<p>Of course you&#8217;d want to put such functions in your <code class="docutils literal"><span class="pre">.bashrc</span></code> file.</p>
</div>
<div class="section" id="if-then-else">
<h3><a class="toc-backref" href="#id28">If/then/else</a><a class="headerlink" href="#if-then-else" title="Permalink to this headline">¶</a></h3>
<p>We can use if-then-else type syntax to control the flow of a shell
script. For an example, here is a shell function <code class="docutils literal"><span class="pre">niceR()</span></code> that
can be used for nicing R jobs:</p>
<div class="highlight-python"><div class="highlight"><pre># niceR shortcut for nicing R jobs
# usage: niceR inputRfile outputRfile
# Author: Brian Caffo
# Date: 10/01/03

function niceR(){
    # submits nice&#39;d R jobs
if [ $# != &quot;2&quot; ]
then
   echo &quot;usage: niceR inputRfile outputfile&quot;
elif [ -e &quot;$2&quot; ]
then
   echo &quot;$2 exists, I won&#39;t overwrite&quot;
elif [ ! -e &quot;$1&quot; ]
then
   echo &quot;inputRfile $1 does not exist&quot;
else
   echo &quot;running R on $1&quot;
   nice -n 19 R --no-save &lt; $1 &amp;&gt; $2
fi
}
</pre></div>
</div>
<p>For more details, look in Newham&amp;Rosenblatt or search online.</p>
</div>
<div class="section" id="for-loops">
<h3><a class="toc-backref" href="#id29">For loops</a><a class="headerlink" href="#for-loops" title="Permalink to this headline">¶</a></h3>
<p><em>for</em> loops in shell scripting are primarily designed for iterating
through a set of files or directories. Here&#8217;s an example:</p>
<div class="highlight-python"><div class="highlight"><pre>for file in $(ls *.txt)
do
   mv $file ${file/.txt/.R}
   # this syntax replaces .txt with .R in $file``
done
</pre></div>
</div>
<p>Another use of <em>for</em> loops is automating file downloads:</p>
<div class="highlight-python"><div class="highlight"><pre># example of bash for loop and wget for downloading a collection of files on the web
# usage: ./forloopDownload.sh
# Author: Chris Paciorek
# Date: July 28, 2011

url=&#39;ftp://ftp3.ncdc.noaa.gov/pub/data/3200&#39;
IFS=:  # internal field separator
mths=jan:feb:mar:apr
for ((yr=1910; yr&lt;=1920; yr++))
do
    for mth in ${mths}
    do
        wget ${url}/${yr}/3200${mth}${yr}
    done
done
</pre></div>
</div>
<p><em>for</em> loops are very useful for starting a series of jobs:</p>
<div class="highlight-python"><div class="highlight"><pre># example of bash for loop for starting jobs
# usage: ./forloopJobs.sh
# Author: Chris Paciorek
# Date: July 28, 2011

n=100
for(( it=1; it&lt;=100; it++));
do
    echo &quot;n=$n; it=$it; source(&#39;base.R&#39;)&quot; &gt; tmp-$n-$it.R
    R CMD BATCH --no-save tmp-$n-$it.R sim-n$n-it$it.Rout
done
# note that base.R should NOT set either &#39;n&#39; or &#39;it&#39;
</pre></div>
</div>
</div>
<div class="section" id="how-much-shell-scripting-should-i-learn">
<h3><a class="toc-backref" href="#id30">How much shell scripting should I learn?</a><a class="headerlink" href="#how-much-shell-scripting-should-i-learn" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;ve covered most of what you are likely to need to know about the shell. I
tend to only use bash scripts for simple tasks that require only a few lines of
bash commands and very little control flow (i.e., conditional statements,
loops).  For more complicated OS tasks, it is often preferable to use Python.
You can also do a fair amount of what you need from within R using the
<code class="docutils literal"><span class="pre">system()</span></code> function. This will enable you to avoid dealing with a lot of
shell programming syntax (but you&#8217;ll still need to know how to use UNIX
utilities, wildcards, and pipes to be effective).</p>
</div>
</div>
<div class="section" id="working-with-documents">
<h2><a class="toc-backref" href="#id31">Working with documents</a><a class="headerlink" href="#working-with-documents" title="Permalink to this headline">¶</a></h2>
<p>There are many plain text file formats (e.g., markdown, reStructuredText,
LaTeX).  Pandoc is a widely used document converter.  To convert a file
written in markdown (<code class="docutils literal"><span class="pre">report.md</span></code>) to a PDF (<code class="docutils literal"><span class="pre">report.pdf</span></code>), you would
do something like:</p>
<div class="highlight-python"><div class="highlight"><pre>$ pandoc -o report.pdf report.md
</pre></div>
</div>
<p>For a quick introduction to LaTeX, please see the &#8220;Introduction to LaTeX&#8221;
tutorial and screencast here:
<a class="reference external" href="http://statistics.berkeley.edu/computing/training/tutorials">http://statistics.berkeley.edu/computing/training/tutorials</a></p>
</div>
<div class="section" id="exercises">
<h2><a class="toc-backref" href="#id32">Exercises</a><a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Make a variable, called <code class="docutils literal"><span class="pre">mypython</span></code> that contains the path to Python on
your machine.</p>
</li>
<li><p class="first">Construct a variable that has <code class="docutils literal"><span class="pre">&lt;username&gt;&#64;&lt;machinename&gt;</span></code> using existing
environment variables and the <code class="docutils literal"><span class="pre">hostname</span></code> utility.</p>
</li>
<li><p class="first">Figure out how to use the <code class="docutils literal"><span class="pre">mkdir</span></code> command to create the following directory
structure in one short command:</p>
<div class="highlight-python"><div class="highlight"><pre>temp
├── proj1
│   ├── code
│   └── data
├── proj2
│   ├── code
│   └── data
└── proj3
    ├── code
    └── data
</pre></div>
</div>
</li>
<li><p class="first">How would you count the number of lines in an input file, say a data file.</p>
</li>
<li><p class="first">Print the first three lines of a file to the screen. Now print just the
third line to the screen.</p>
</li>
<li><p class="first">Put the third line of a file in a new file.</p>
</li>
<li><p class="first">Now add the fifth line of the file to that same file from the previous problem.</p>
</li>
<li><p class="first">Extract the Australia data from the <code class="docutils literal"><span class="pre">cpds.csv</span></code> dataset and put it in a file
called <code class="docutils literal"><span class="pre">cpds_australia.csv</span></code>. It&#8217;s OK if you do this in a straightforward way
and it might fail if &#8216;Australia&#8217; is present in an unexpected column.</p>
</li>
<li><p class="first">Find all the lines in a file that do not contain a comma.
(You might use this to look for anomalies in a CSV file.)</p>
</li>
<li><p class="first">Write shell code that creates files <code class="docutils literal"><span class="pre">file1.txt</span></code>, <code class="docutils literal"><span class="pre">file2.txt</span></code>,
<code class="docutils literal"><span class="pre">file3.txt</span></code>, etc., with the word &#8216;blah&#8217; as the only line in each file.</p>
</li>
<li><p class="first">Write shell code that modifies each file from the previous problem so that
the number <code class="docutils literal"><span class="pre">1</span></code>, <code class="docutils literal"><span class="pre">2</span></code>, <code class="docutils literal"><span class="pre">3</span></code>, etc. is prepended to the appropriate file
(i.e., there is a new first line in each file that simply contains the
number corresponding to the file name).</p>
<p>You may want to write the code to do this operation on a single file before
embedding the code in the loop.</p>
</li>
<li><p class="first">Create a shell function that will run a Python job in the background such
that I can run the job by typing:</p>
<div class="highlight-python"><div class="highlight"><pre>$ bpy file.py file.out
</pre></div>
</div>
<p>You can create a test jobs with: <code class="docutils literal"><span class="pre">echo</span> <span class="pre">-e</span> <span class="pre">'a=5\nprint(a)'</span> <span class="pre">&gt;</span> <span class="pre">file.py</span></code></p>
</li>
<li><p class="first">Modify the function so that you can simply type</p>
<div class="highlight-python"><div class="highlight"><pre>$ bpy file.py
</pre></div>
</div>
<p>and it will use <code class="docutils literal"><span class="pre">file.pyout</span></code> as the output file</p>
</li>
<li><p class="first">Use <code class="docutils literal"><span class="pre">ps</span></code> to print out all the processes on the machine with information on
memory and CPU use and sort the output of <code class="docutils literal"><span class="pre">ps</span></code> in decreasing order of memory use.</p>
</li>
<li><p class="first">Take <code class="docutils literal"><span class="pre">$mypython</span></code> from the first problem and strip the <code class="docutils literal"><span class="pre">python</span></code> off the
end&#8212;assigning the result to a new variable, <code class="docutils literal"><span class="pre">path_to_py</span></code>.</p>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Capstone</a></h1>



<p class="blurb">Spring 2016</p>




<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../lectures/index.html">Lectures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Appendices</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="software.html">Software installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Using the bash shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="git-intro.html">Introduction to Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="git-advanced.html">Collaborative workflow with Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html">Introduction to Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="file-transfer.html">File Transfer</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix1.html">Command Line Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix2.html">File System Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix3.html">Shell Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="over_dimensions.html">Array reduction operations</a></li>
</ul>
</li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://www.jarrodmillman.com/stat222-spring2016/">Course home</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
      &copy;2015, K. Jarrod Millman.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
        <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
    </div>

  </body>
</html>